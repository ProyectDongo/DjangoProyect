{% extends 'base.html' %}
{% block title %}{% block dashboard_title %}{% endblock %}{% endblock %}
{% load static %}
{% block content %}
<div class="container-fluid">
    <!-- Mensajes de alerta -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    <!-- Cabecera del dashboard -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-column flex-md-row">
        <h1 class="h3 mb-2 mb-md-0 text-gray-800">
            {% block dashboard_icon %}{% endblock %}
            {% block dashboard_heading %}{% endblock %}
        </h1>
        <div class="mt-2 mt-md-0 d-flex flex-wrap gap-2">
            {% block dashboard_actions %}{% endblock %}
        </div>
    </div>

    <!-- Tarjetas de estadísticas -->
    <div class="row mb-4">
        {% block dashboard_stats %}{% endblock %}
    </div>

    <!-- Pestañas de navegación -->
    <div class="d-flex justify-content-between align-items-center mb-3 flex-column flex-md-row">
        <ul class="nav mb-2 mb-md-0 dashboard-tabs" id="dashboardTabs">
            {% block dashboard_tabs %}{% endblock %}
        </ul>
        <div class="mt-2 mt-md-0">
            {% block dashboard_tab_actions %}{% endblock %}
        </div>
    </div>

    <!-- Contenido de las pestañas -->
    <div class="tab-content">
        {% block dashboard_tab_content %}{% endblock %}
    </div>

    <!-- Contenido adicional después de las pestañas -->
    {% block dashboard_after_tabs %}{% endblock %}
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'bootstrap/css/base_d.css' %}">
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Manejar el desplazamiento horizontal en pestañas para móviles
        const tabsContainer = document.querySelector('.dashboard-tabs');
        if (tabsContainer && window.innerWidth < 768) {
            tabsContainer.addEventListener('wheel', function(e) {
                if (e.deltaY !== 0) {
                    e.preventDefault();
                    tabsContainer.scrollLeft += e.deltaY;
                }
            });
        }
        
        // Mejorar accesibilidad en móviles
        if (window.innerWidth < 768) {
            document.querySelectorAll('.btn').forEach(btn => {
                btn.style.minHeight = '44px';
                btn.style.minWidth = '44px';
            });
        }
        
        // Inicializar tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>
{% endblock %}

<!-- Bloque para tabla RPE/RIR reutilizable -->
{% block rpe_table %}
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Tabla de Referencia RPE/RIR</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered rpe-table excel-table">
                <thead class="excel-header">
                    <tr>
                        <th>ESCALA RPE</th>
                        <th class="mobile-hidden">¿QUÉ SIGNIFICA? RPE</th>
                        <th>ESCALA RIR</th>
                        <th class="mobile-hidden">¿QUÉ SIGNIFICA? RIR</th>
                        <th>RELACIÓN</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="excel-cell text-center">10.0</td>
                        <td class="excel-cell mobile-hidden">Máximo esfuerzo, no puede hacer más repeticiones</td>
                        <td class="excel-cell text-center">0.0</td>
                        <td class="excel-cell mobile-hidden">No queda ninguna repetición (fallo)</td>
                        <td class="excel-cell text-center">RPE 10 = RIR 0</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">9.5</td>
                        <td class="excel-cell mobile-hidden">Podría haber hecho 0-1 repetición más</td>
                        <td class="excel-cell text-center">0-1</td>
                        <td class="excel-cell mobile-hidden">Casi al fallo, máxima exigencia</td>
                        <td class="excel-cell text-center">RPE 9.5 = RIR 0-1</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">9.0</td>
                        <td class="excel-cell mobile-hidden">Te quedan 1 repetición más</td>
                        <td class="excel-cell text-center">1.0</td>
                        <td class="excel-cell mobile-hidden">Te queda 1 repetición en reserva</td>
                        <td class="excel-cell text-center">RPE 9 = RIR 1</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">8.5</td>
                        <td class="excel-cell mobile-hidden">Te quedan 1-2 repeticiones más</td>
                        <td class="excel-cell text-center">1-2</td>
                        <td class="excel-cell mobile-hidden">Muy cerca del fallo, pero sin alcanzarlo</td>
                        <td class="excel-cell text-center">RPE 8.5 = RIR 1-2</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">8.0</td>
                        <td class="excel-cell mobile-hidden">Te quedan 2 repeticiones más</td>
                        <td class="excel-cell text-center">2.0</td>
                        <td class="excel-cell mobile-hidden">Te quedan 2 repeticiones antes del fallo</td>
                        <td class="excel-cell text-center">RPE 8 = RIR 2</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">7.5</td>
                        <td class="excel-cell mobile-hidden">Te quedan 2-3 repeticiones más</td>
                        <td class="excel-cell text-center">2-3</td>
                        <td class="excel-cell mobile-hidden">Entrenamiento moderado</td>
                        <td class="excel-cell text-center">RPE 7.5 = RIR 2-3</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">7.0</td>
                        <td class="excel-cell mobile-hidden">Te quedan 3 repeticiones más</td>
                        <td class="excel-cell text-center">3.0</td>
                        <td class="excel-cell mobile-hidden">Mucho margen, esfuerzo bajo</td>
                        <td class="excel-cell text-center">RPE 7 = RIR 3</td>
                    </tr>
                    <tr>
                        <td class="excel-cell text-center">6 o MENOS</td>
                        <td class="excel-cell mobile-hidden">Calentamiento o muy poca carga</td>
                        <td class="excel-cell text-center">4 o MÁS</td>
                        <td class="excel-cell mobile-hidden">Sería muy fácil</td>
                        <td class="excel-cell text-center">RPE 6 = RIR 4+</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

<!-- Bloque para sección de calentamientos reutilizable -->
{% block warmup_section %}
<div class="d-flex justify-content-between align-items-center mb-3 flex-column flex-md-row">
    <h6 class="m-0 font-weight-bold text-primary">Ejercicios de Calentamiento</h6>
    <div class="mt-2 mt-md-0">
        {% block warmup_actions %}{% endblock %}
    </div>
</div>

<div class="row">
    <!-- Tren Inferior -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Tren Inferior</h6>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-bordered excel-table m-0" width="100%" cellspacing="0">
                        <thead class="excel-header">
                            <tr>
                                <th>Ejercicio</th>
                                <th>Series/Reps</th>
                                <th class="mobile-hidden">Notas</th>
                                <th>{% block warmup_lower_actions_header %}Video{% endblock %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for warmup in warmups.lower_body %}
                            <tr>
                                <td class="excel-cell">{{ warmup.name }}</td>
                                <td class="excel-cell">{{ warmup.series_reps }}</td>
                                <td class="excel-cell mobile-hidden">{{ warmup.notes }}</td>
                                <td class="excel-cell">
                                    {% block warmup_lower_actions %}
                                    {% if warmup.video_url %}
                                    <a href="{{ warmup.video_url }}" target="_blank" class="btn btn-sm btn-outline-info">
                                        <i class="bi bi-play-btn"></i>
                                    </a>
                                    {% endif %}
                                    {% endblock %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Tren Superior -->
    <div class="col-lg-6 mb-4">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Tren Superior</h6>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-bordered excel-table m-0" width="100%" cellspacing="0">
                        <thead class="excel-header">
                            <tr>
                                <th>Ejercicio</th>
                                <th>Series/Reps</th>
                                <th class="mobile-hidden">Notas</th>
                                <th>{% block warmup_upper_actions_header %}Video{% endblock %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for warmup in warmups.upper_body %}
                            <tr>
                                <td class="excel-cell">{{ warmup.name }}</td>
                                <td class="excel-cell">{{ warmup.series_reps }}</td>
                                <td class="excel-cell mobile-hidden">{{ warmup.notes }}</td>
                                <td class="excel-cell">
                                    {% block warmup_upper_actions %}
                                    {% if warmup.video_url %}
                                    <a href="{{ warmup.video_url }}" target="_blank" class="btn btn-sm btn-outline-info">
                                        <i class="bi bi-play-btn"></i>
                                    </a>
                                    {% endif %}
                                    {% endblock %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}